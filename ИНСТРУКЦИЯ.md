# Инструкция по использованию проекта Fireclicks Test

## Быстрый старт

### 1. Настройка Addressables (ОБЯЗАТЕЛЬНО!)

**Без этого игра не будет работать!**

1. Откройте **Window → Asset Management → Addressables → Groups**
2. Найдите сцену `Assets/Scenes/GameLoopScene.unity`
3. **Правый клик** → **Mark as Addressable**
4. В Inspector установите **Address** = `"GameLoopScene"` (без кавычек)

Подробная инструкция: см. `ADDRESSABLES_SETUP.md`

### 2. Запуск сервера

```bash
cd Server
dotnet run
```

Сервер запустится на `http://localhost:5000`

### 3. Запуск игры

1. Убедитесь, что `LoadingScene.unity` установлена как первая сцена в **File → Build Settings**
2. Нажмите **Play** в Unity Editor

---

## Что происходит при запуске

1. **InitializationState** (инициализация):
   - Инициализируется логгер
   - Создаётся CPU Frame Time overlay (правый верхний угол)
   - Генерируется/загружается токен пользователя

2. **LoadingState** (загрузка):
   - Появляется экран загрузки с прогресс-баром
   - Загружается `GameLoopScene` через Addressables

3. **GameLoopState** (игровой процесс):
   - Открывается игровая сцена с табами

---

## Настройка UI в GameLoopScene

### Структура табов

Создайте следующую структуру:

```
Canvas
├── TabsController (компонент TabsController)
│   ├── ListTab (GameObject)
│   │   └── VirtualizedList (компонент VirtualizedList)
│   ├── GroupedListTab (GameObject)
│   │   └── GroupedList (компонент GroupedList)
│   └── RequestTab (GameObject)
│       └── RequestTabController (компонент RequestTabController)
└── TabButtons (GameObject)
    ├── Button1 → вызывает TabsController.ShowListTab()
    ├── Button2 → вызывает TabsController.ShowGroupedListTab()
    └── Button3 → вызывает TabsController.ShowRequestTab()
```

### Настройка VirtualizedList

1. Создайте UI с `ScrollRect`:
   ```
   ScrollRect
   ├── Viewport
   │   └── Content (RectTransform)
   └── Scrollbar (опционально)
   ```

2. Создайте прототип элемента:
   ```
   ItemPrototype (RectTransform)
   └── Text (TMP_Text)
   ```

3. Добавьте компонент `VirtualizedList` на ScrollRect:
   - **Scroll Rect** → ссылка на ScrollRect
   - **Content** → ссылка на Content RectTransform
   - **Item Prototype** → ссылка на ItemPrototype
   - **Total Count** = 1000
   - **Item Height** = 40

4. Для GroupedList:
   - Добавьте компонент `GroupedList` на тот же объект
   - **List** → ссылка на VirtualizedList

### Настройка RequestTab

1. Добавьте `RequestTabController` на объект RequestTab
2. Настройте в Inspector:
   - **Server Base Url** = `"http://localhost:5000"`
   - **Result Text** → ссылка на TMP_Text для отображения результата
3. Создайте кнопку, вызывающую `RequestTabController.SendRequest()`

---

## Переключение провайдера логирования

В файле `Assets/Scripts/Infrastructure/GameInstaller.cs`:

```csharp
// Unity Console (по умолчанию):
Container.Bind<ILogProvider>().To<UnityLogProvider>().AsSingle();

// Файловое логирование:
Container.Bind<ILogProvider>().To<FileLogProvider>().AsSingle();
```

**Включение логирования:**
1. **Edit → Project Settings → Player → Other Settings**
2. В **Scripting Define Symbols** добавьте: `ENABLE_LOGS`

Без этого символа все логи будут удалены компилятором.

---

## Проверка работы

### ✅ CPU Frame Time
- Должен отображаться в правом верхнем углу
- Формат: `"CPU Frame Time: X.XX ms"`
- Обновляется каждый кадр

### ✅ Экран загрузки
- Появляется при загрузке GameLoopScene
- Показывает прогресс 0-100%
- Исчезает после загрузки

### ✅ Список (1000 элементов)
- Прокрутка работает плавно
- Создаются только видимые элементы
- Каждый элемент показывает свой индекс

### ✅ Группированный список
- Порядок: 1 2 3 1 2 3 1 2 1 ...
- Цвета: зелёный, фиолетовый, золотой
- Всего 18 элементов

### ✅ Request Tab
- Кнопка отправляет запрос на сервер
- Отображается количество запросов
- При повторных запросах счётчик увеличивается

---

## Решение проблем

### Ошибка "Failed to add TMP_Text component"
**Решение:** 
1. Импортируйте TextMeshPro в проект:
   - Откройте **Window → Package Manager**
   - Выберите **Unity Registry** в левом верхнем углу
   - Найдите **TextMeshPro** в списке
   - Нажмите **Install**
2. После установки Unity может предложить импортировать TMP Essentials - нажмите **Import TMP Essentials**
3. Если ошибка сохраняется, проверьте, что в коде используется правильный namespace `using TMPro;`

**Примечание:** Код автоматически использует fallback на Unity Text, если TMP недоступен, но для полной функциональности рекомендуется импортировать TextMeshPro.

### Ошибка "InvalidKeyException" при загрузке сцены
**Решение:** Проверьте, что `GameLoopScene` помечена как Addressable с адресом `"GameLoopScene"`

### CPU Frame Time не отображается
**Решение:** Убедитесь, что TextMeshPro импортирован в проект

### Список не прокручивается
**Решение:** 
- Проверьте, что ScrollRect настроен правильно
- Убедитесь, что Content имеет достаточную высоту
- Проверьте, что Item Height установлен правильно

### Request Tab не работает
**Решение:**
- Убедитесь, что сервер запущен на `http://localhost:5000`
- Проверьте настройки `Server Base Url` в Inspector
- Проверьте консоль Unity на наличие ошибок

### Токен не сохраняется
**Решение:** 
- Проверьте права на запись в `Application.persistentDataPath`
- Убедитесь, что `PlayerPrefs.Save()` вызывается

---

## Архитектура

### State Machine
- `InitializationState` → `LoadingState` → `GameLoopState`
- Управляется через `GameStateMachine`

### Dependency Injection
- Используется Zenject
- Настройка в `GameInstaller`
- Все зависимости инжектируются автоматически

### Асинхронность
- Используется UniTask для async/await
- Загрузка сцен через Addressables асинхронная
- API запросы асинхронные

---

## Важные файлы

- `Bootstrapper.cs` - точка входа, управляет State Machine
- `GameInstaller.cs` - настройка DI контейнера
- `States.cs` - реализации состояний
- `LoadingScreenController.cs` - экран загрузки
- `CpuFrameTimeOverlay.cs` - CPU Frame Time overlay
- `VirtualizedList.cs` - виртуализированный список
- `GroupedList.cs` - группированный список
- `RequestTabController.cs` - контроллер таба с запросами
- `TokenManager.cs` - управление токенами
- `ApiClient.cs` - клиент API
- `Logger.cs` - система логирования

---

## Дополнительная информация

Подробная документация: см. `README.md`
Настройка Addressables: см. `ADDRESSABLES_SETUP.md`

